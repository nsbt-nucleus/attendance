const g=(function(){let a=!![];return function(M,o){const Q=a?function(){if(o){const H=o['apply'](M,arguments);return o=null,H;}}:function(){};return a=![],Q;};}()),c=g(this,function(){return c['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](c)['search']('(((.+)+)+)+$');});c();import{server}from'./config.js';$(function(){function p(j,f){(f===undefined||f===null)&&(f='Something\x20went\x20wrong...');let Y=new Date(),O='toast'+Y['getHours']()+Y['getMinutes']()+Y['getSeconds'](),n=$('<div\x20class=\x22toast\x22\x20role=\x22alert\x22\x20id=\x22'+O+'\x22\x20aria-live=\x22assertive\x22\x20aria-atomic=\x22true\x22></div>'),I=$('<div\x20class=\x22toast-header\x22>\x20<strong\x20class=\x22me-auto\x22>'+j+'</strong>\x20<button\x20type=\x22button\x22\x20class=\x22btn-close\x22\x20data-bs-dismiss=\x22toast\x22\x20aria-label=\x22Close\x22></button>\x20</div>'),J=$('<div\x20class=\x22toast-body\x22>'+f+'</div>');return I['appendTo'](n),J['appendTo'](n),$('.toast-container')['append'](n),$('#'+O)['toast']('show'),setTimeout(function(){n['remove']();},-0xab7+0x244e+-0xddf),O;}let l=undefined;const B={};B['ideal']=0xa,B['max']=0xf;const A={};A['frameRate']=B;const E={};E['facingMode']='user',E['video']=A;const P={};P['audio']=![],P['video']=E;const b=P;setInterval(function(){let j=$('#userId')['val']();j==='scanning'||j['length']==-0x26df+-0x1*-0xaa+0x2635*0x1?($('#btnUpload')['attr']('disabled','disabled'),$('#btnOutTime')['attr']('disabled','disabled')):setTimeout(function(){$('#btnUpload')['removeAttr']('disabled'),$('#btnOutTime')['removeAttr']('disabled');},0x210d+-0xe3*-0x1f+-0x3a96);},-0x1*0x1022+0x1*-0x6a6+0xb96*0x2);function U(j){if(j['length']==-0xfc6*-0x1+0xc46*0x1+-0x1c0c)return null;var f={},Y=j[0x2e*-0x2e+0x3*-0x1ca+0xa*0x15d],O=0x21e*-0x4+0x3*0x2bd+0x42*0x1;for(var n=0x8b8+0x1170*0x1+-0x117*0x18;n<j['length'];n++){var I=j[n];if(f[I]==null)f[I]=-0xc9e+0x3*-0x175+0x10fe;else f[I]++;f[I]>O&&(Y=I,O=f[I]);}return Y;}let V=[];const N={};N['keyboard']=!![];var h=new bootstrap['Modal'](document['getElementById']('attendance-alert'),N);$('.dismiss')['click'](()=>{h['hide']();});const R={};R['width']=0x168,R['height']=0x10e,R['image_format']='jpeg',R['jpeg_quality']=0x64,Webcam['set'](R),Webcam['attach']('#webcam');const S=document['getElementsByTagName']('video')[0x1850+-0x1e47+-0x5f7*-0x1];Promise['all']([faceapi['nets']['ssdMobilenetv1']['loadFromUri']('../../models'),faceapi['nets']['faceRecognitionNet']['loadFromUri']('../../models'),faceapi['nets']['faceLandmark68Net']['loadFromUri']('../../models')])['then'](z);const X=async()=>{const j=await fetch(server+'/users');return j['json']();};function z(){navigator['mediaDevices']['getUserMedia'](b)['then'](j=>{S['srcObject']=j;})['catch'](j=>{p('error\x20starting\x20web\x20cam',j);});}async function i(){const j=await X(),f=[];return j['data'][0xf29+-0x717+0x409*-0x2]['forEach']((Y,O)=>{f['push'](Y['userId']);}),console['log'](f),Promise['all'](f['map'](async Y=>{const O=[];for(let n=0x4df+0x1293+-0x1771;n<=0x1b95+-0x67*0x2b+-0xa46;n++){console['log']('../../labels/'+Y+'/'+n+'.jpeg');const I=await faceapi['fetchImage']('../../labels/'+Y+'/'+n+'.jpeg'),J=await faceapi['detectSingleFace'](I)['withFaceLandmarks']()['withFaceDescriptor']();if(!J)throw new Error('no\x20faces\x20detected\x20for\x20'+Y);O['push'](J['descriptor']);}return new faceapi['LabeledFaceDescriptors'](Y,O);}));}S['addEventListener']('play',async()=>{const j=0xf8*0xf+0x18d7+-0x275f*0x1+0.48,f=await i(),Y=new faceapi['FaceMatcher'](f,j);$('#spinner')['hide']();const O=faceapi['createCanvasFromMedia'](S);$('#canvas')['empty'](),$('#canvas')['append'](O);const n={};n['width']=0x168,n['height']=0x10e;const I=n;faceapi['matchDimensions'](O,I),setInterval(async()=>{const J=await faceapi['detectAllFaces'](S)['withFaceLandmarks']()['withFaceDescriptors'](),x=faceapi['resizeResults'](J,I);O['getContext']('2d')['clearRect'](0x1*-0x25f+0x138b*-0x1+0x15ea,0x1d87*0x1+0x5*-0x649+0x1e6,O['width'],O['height']);const d=x['map'](G=>{return Y['findBestMatch'](G['descriptor'],j);});d['length']>=-0x18*0x10c+-0x2c*0x1+0x194e&&p('attendance\x20alert','only\x20one\x20person\x20at\x20a\x20time\x20please'),d['length']==0x2*-0xf1a+-0x1*0x12b4+0x30e9&&d['forEach']((G,C)=>{const s=x[C]['detection']['box'],e={};e['label']=G;const T=new faceapi['draw']['DrawBox'](s,e);T['draw'](O),V['push'](G['_label']);if(V['length']>=-0xd6d+0xf*0x1b6+-0xc38){let m=U(V);V=[],$('#userId')['val'](m);let k=$('#userId')['val']();k==='scanning'&&$('#userId')['val']('scanning'),k!=='scanning'&&k!=l&&(console['log']('capturing....'),l=k,$('#btnCapture')['click']());}});},-0x2e6+-0x1*0x1a53+0x1e01);}),$('#btnCapture')['click'](function(){Webcam['snap'](function(j){$('#imgCapture')[0x2536+-0x2629+0xf3]['src']=j,$('#btnUpload')['removeAttr']('disabled');});}),$('#btnUpload')['click'](function(){$('#btnUpload')['html']('<div\x20class=\x22spinner-border\x22\x20role=\x22status\x22\x20></div>');const j=$('#imgCapture')[-0x27f*0x3+0x1*-0x37e+-0x1*-0xafb]['src'],f=$('#userId')['val']();if(f===undefined||f['length']==0x165d+0xa*-0x3d0+0xfc3){$('#btnUpload')['text']('in-time'),p('userId\x20cannot\x20be\x20empty');return;}const Y={};Y['data']=j,Y['userId']=f;const O=Y;console['log'](O['email']);const n=JSON['stringify'](O);$['ajax']({'type':'POST','url':server+'/attendance/in-time','contentType':'application/json','data':JSON['stringify'](O),'dataType':'json','success':function(I){$('#btnUpload')['text']('in-time'),console['log'](I),p('attendance\x20in-time\x20register\x20successfully',I['message']);},'error':function(I){$('#btnUpload')['text']('in-time'),console['log'](I);let J=JSON['parse'](I['responseText'])['message'];JSON['parse'](I['responseText'])['errors']['forEach'](x=>J+='<br>\x20'+x),p('attendance\x20in-time\x20register\x20failed',J);}});}),$('#btnOutTime')['click'](function(){$('#btnOutTime')['html']('<div\x20class=\x22spinner-border\x22\x20role=\x22status\x22\x20></div>');const j=$('#userId')['val']();if(j===undefined||j['length']==-0x339+0x24d2*0x1+-0xb33*0x3){$('#btnOutTime')['text']('out-time'),h['show'](),$('.modal-title')['text']('cannot\x20take\x20attendance'),$('.modal-body\x20>\x20p')['text']('userId\x20cannot\x20be\x20empty');return;}$['ajax']({'type':'GET','url':server+'/attendance/out-time/'+j,'success':function(f){$('#btnOutTime')['text']('out-time'),p('attendance\x20out-time\x20register\x20successfully',f['message']);},'error':function(f){$('#btnOutTime')['text']('out-time'),console['log'](f);let Y=JSON['parse'](f['responseText'])['message'];JSON['parse'](f['responseText'])['errors']['forEach'](O=>Y+='<br>\x20'+O),p('attendance\x20in-time\x20register\x20failed',Y);}});});});